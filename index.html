<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dashboard PNR</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div id="loginOverlay" class="vh-100 d-flex align-items-center justify-content-center">
  <div class="bg-white p-4 rounded shadow" style="width:350px">
    <h5 class="text-center mb-3">ðŸ”’ Login</h5>
    <input id="usernameInput" class="form-control mb-2" placeholder="Username">
    <input id="passwordInput" type="password" class="form-control mb-3" placeholder="Password">
    <button onclick="attemptLogin()" class="btn btn-success w-100">Log Masuk</button>
  </div>
</div>

<div id="dashboardWrapper" style="display:none">
  <nav class="navbar navbar-dark bg-success px-3">
    <span class="navbar-brand">Dashboard PNR</span>
    <span id="welcomeUser" class="text-white small"></span>
  </nav>

  <div class="container mt-4">
    <h5>Data Dashboard</h5>
    <pre id="dataBox" class="bg-white p-3 border rounded"></pre>
  </div>
</div>

<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzi8Vpza9jEy9PBmyJsBndqTb9Zpi1HpAO10a35LfBUhQFS9pRyTI52vw6M4hDgPzSagA/exec";

let loggedInUser = null;

function attemptLogin() {
  fetch(`${WEBAPP_URL}?action=verifyUserLogin&username=${usernameInput.value}&password=${passwordInput.value}`)
    .then(r => r.json())
    .then(res => {
      if (res.error) return alert(res.message);

      loggedInUser = res;
      loginOverlay.style.display = "none";
      dashboardWrapper.style.display = "block";
      welcomeUser.innerText = `${res.name} (${res.role})`;

      loadDashboard();
    });
}

function loadDashboard() {
  fetch(`${WEBAPP_URL}?action=dashboard&state=${loggedInUser.state}`)
    .then(r => r.json())
    .then(data => {
      console.log("DATA:", data, Array.isArray(data));
      dataBox.innerText = JSON.stringify(data, null, 2);
    })
    .catch(() => alert("Ralat sambungan API"));
}
</script>

</body>
</html>
