<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Login Dashboard PNR</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-dark">

<div class="vh-100 d-flex align-items-center justify-content-center">
  <div class="bg-white p-4 rounded shadow" style="width:350px">
    <h5 class="text-center mb-3">ðŸ”’ Login</h5>

    <input id="username" class="="form-control mb-2" placeholder="Username">
    <input id="password" type="password" class="form-control mb-3" placeholder="Password">

    <button id="loginBtn" class="btn btn-success w-100">
      Log Masuk
    </button>

    <div id="msg" class="text-danger small mt-2"></div>
  </div>
</div>

<!-- TEMPAT PAPAR DATA -->
<div id="output" class="container mt-4 text-white"></div>

<script>
/* ===============================
   KONFIGURASI
================================ */
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzi8Vpza9jEy9PBmyJsBndqTb9Zpi1HpAO10a35LfBUhQFS9pRyTI52vw6M4hDgPzSagA/exec; // ðŸ”´ GANTI URL AWAK

let loggedInUser = null;

/* ===============================
   LOGIN
================================ */
document.getElementById("loginBtn").addEventListener("click", () => {
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();

  if (!u || !p) {
    msg.innerText = "Sila isi username & password";
    return;
  }

  fetch(`${WEBAPP_URL}?action=verifyUserLogin&username=${encodeURIComponent(u)}&password=${encodeURIComponent(p)}`)
    .then(r => r.json())
    .then(res => {
      console.log("LOGIN RESPONSE:", res);

      if (res.error) {
        msg.innerText = res.message;
        return;
      }

      loggedInUser = res;
      msg.innerText = "Login berjaya";

      loadAnalisisData(); // ðŸ”¥ PENTING
    })
    .catch(err => {
      console.error(err);
      msg.innerText = "Ralat sambungan";
    });
});

/* ===============================
   LOAD DATA (DEBUG)
================================ */
function loadAnalisisData() {
  fetch(`${WEBAPP_URL}?action=getAllDashboardData&state=${loggedInUser.state}`)
    .then(r => r.json())
    .then(data => {
      console.log("DATA DITERIMA:", data);

      if (!Array.isArray(data)) {
        alert("Data bukan array â€” semak backend");
        return;
      }

      document.getElementById("output").innerHTML = `
        <h5>Data Dashboard (${data.length} rekod)</h5>
        <pre style="background:#222;color:#0f0;padding:10px;">
${JSON.stringify(data, null, 2)}
        </pre>
      `;
    })
    .catch(err => {
      console.error(err);
      alert("Ralat ambil data dashboard");
    });
}
</script>

</body>
</html>
