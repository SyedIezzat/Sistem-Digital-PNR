<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Login Dashboard PNR</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-dark">

<div class="vh-100 d-flex align-items-center justify-content-center">
  <div class="bg-white p-4 rounded shadow" style="width:350px">
    <h5 class="text-center mb-3">ðŸ”’ Login</h5>

    <input id="username" class="form-control mb-2" placeholder="Username">
    <input id="password" type="password" class="form-control mb-3" placeholder="Password">

    <button id="loginBtn" class="btn btn-success w-100">
      Log Masuk
    </button>

    <div id="msg" class="text-danger small mt-2"></div>
  </div>
</div>

<script>
/* ===============================
   CONFIG
================================ */
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzi8Vpza9jEy9PBmyJsBndqTb9Zpi1HpAO10a35LfBUhQFS9pRyTI52vw6M4hDgPzSagA/exec";
let loggedInUser = null;

/* ===============================
   LOGIN EVENT
================================ */
document.getElementById("loginBtn").addEventListener("click", attemptLogin);

function attemptLogin() {
  console.log("BUTANG LOGIN DIKLIK");

  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();
  const msg = document.getElementById("msg");

  if (!u || !p) {
    msg.innerText = "Sila isi username dan password";
    return;
  }

  fetch(`${WEBAPP_URL}?action=verifyUserLogin&username=${encodeURIComponent(u)}&password=${encodeURIComponent(p)}`)
    .then(r => r.json())
    .then(res => {
      console.log("LOGIN RESPONSE:", res);

      if (res.error) {
        msg.innerText = res.message;
        return;
      }

      loggedInUser = res;
      msg.classList.remove("text-danger");
      msg.classList.add("text-success");
      msg.innerText = "Login berjaya";

      loadAnalisisData();
    })
    .catch(err => {
      console.error(err);
      msg.innerText = "Ralat sambungan ke server";
    });
}

/* ===============================
   TEST DATA LOAD
================================ */
function loadAnalisisData() {
  fetch(`${WEBAPP_URL}?action=getAllDashboardData&state=${loggedInUser.state}`)
    .then(r => r.json())
    .then(data => {
      console.log("DATA DITERIMA:", data);
      alert("Data diterima, semak console");
    })
    .catch(err => {
      console.error(err);
      alert("Gagal ambil data");
    });
}
</script>

</body>
</html>
