<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dashboard PNR</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{background:#f8f9fa}
#loginOverlay{position:fixed;inset:0;background:#212529;display:flex;align-items:center;justify-content:center}
.login-box{background:#fff;padding:30px;border-radius:12px;width:100%;max-width:400px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginOverlay">
  <div class="login-box text-center">
    <h4>ðŸ”’ Akses Dashboard</h4>
    <input id="usernameInput" class="form-control my-2" placeholder="Username">
    <input id="passwordInput" type="password" class="form-control my-2" placeholder="Password">
    <button onclick="attemptLogin()" class="btn btn-success w-100">Log Masuk</button>
    <div id="loginError" class="text-danger small mt-2"></div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboardWrapper" style="display:none">
  <nav class="navbar navbar-dark bg-success px-3">
    <span class="navbar-brand">ðŸŒ± Dashboard PNR</span>
    <span id="welcomeUser" class="text-white small"></span>
  </nav>
  <div class="container mt-4">
    <h5>Dashboard berjaya dimuat</h5>
    <p class="text-muted">Frontend dari GitHub Pages</p>
  </div>
</div>

<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbx-UQ5MGsC668b2qIUwEwShUkAy49PXXDYkoZygKN7VtvxVCHCO_r29O3PTbXrX9-IQZg/exec";

function attemptLogin() {
  const u = usernameInput.value.trim();
  const p = passwordInput.value.trim();
  if (!u || !p) return alert("Sila isi login");

  fetch(`${WEBAPP_URL}?action=verifyUserLogin&username=${encodeURIComponent(u)}&password=${encodeURIComponent(p)}`)
    .then(r => r.json())
    .then(res => {
      if (res.error) {
        alert(res.message);
        return;
      }

      loggedInUser = res;
      loginOverlay.style.display = "none";
      dashboardWrapper.style.display = "block";
      document.getElementById("welcomeUser").innerText =
        `Selamat datang, ${res.name} (${res.role.toUpperCase()})`;

      loadAnalisisData();
    })
    .catch(err => alert("Ralat sambungan"));
}
</script>
