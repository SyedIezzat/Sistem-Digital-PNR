<script>
let loggedInUser = null;

const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbw6BhrJCJcJYT9fZ-pAhZNY5akunn_cE4NLIV10kVF-di3UseT_ogGWBp-ApSuoumuGdw/exec";

function attemptLogin() {
  const u = document.getElementById("usernameInput").value.trim();
  const p = document.getElementById("passwordInput").value.trim();

  if (!u || !p) {
    alert("Sila isi login");
    return;
  }

  fetch(`${WEBAPP_URL}?action=verifyUserLogin&username=${encodeURIComponent(u)}&password=${encodeURIComponent(p)}`)
    .then(r => r.json())
    .then(res => {
      if (res.error) {
        alert(res.message);
        return;
      }

      // LOGIN BERJAYA
      loggedInUser = res;

      document.getElementById("loginOverlay").style.display = "none";
      document.getElementById("dashboardWrapper").style.display = "block";
      document.getElementById("welcomeUser").innerText =
        `Selamat datang, ${res.name} (${res.role.toUpperCase()})`;

      console.log("LOGIN OK:", loggedInUser);
    })
    .catch(err => {
      console.error(err);
      alert("Ralat sambungan ke server");
    });
}
</script>
